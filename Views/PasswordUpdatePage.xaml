<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:BrainWave.APP.ViewModels"
             xmlns:converters="clr-namespace:BrainWave.APP.Converters"
             x:Class="BrainWave.APP.Views.PasswordUpdatePage"
             Title="Update Password"
             BackgroundColor="{AppThemeBinding Light=#F8F9FA, Dark=#1A1A1A}">



    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">
            
            <!-- Header -->
            <Frame BackgroundColor="{AppThemeBinding Light=#4A90E2, Dark=#2C5AA0}" 
                   CornerRadius="12" 
                   Padding="20" 
                   HasShadow="True">
                <VerticalStackLayout>
                    <Label Text="ðŸ”’ Update Password" 
                           FontSize="24" 
                           FontAttributes="Bold" 
                           TextColor="White" 
                           HorizontalOptions="Center" />
                    <Label Text="Change your account password" 
                           FontSize="14" 
                           TextColor="White" 
                           Opacity="0.9" 
                           HorizontalOptions="Center" />
                </VerticalStackLayout>
            </Frame>

            <!-- Current Password -->
            <Frame BackgroundColor="{AppThemeBinding Light=#FFFFFF, Dark=#2D2D2D}" 
                   CornerRadius="12" 
                   Padding="20" 
                   HasShadow="True">
                <VerticalStackLayout Spacing="15">
                    <Label Text="Current Password *" 
                           FontSize="16" 
                           FontAttributes="Bold" 
                           TextColor="{AppThemeBinding Light=#333333, Dark=#FFFFFF}" />
                    
                    <Frame BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#404040}" 
                           CornerRadius="12" 
                           Padding="16" 
                           HasShadow="False">
                        <Entry Placeholder="Enter current password" 
                               Text="{Binding CurrentPassword}" 
                               IsPassword="True"
                               BackgroundColor="Transparent" 
                               TextColor="{AppThemeBinding Light=#333333, Dark=#FFFFFF}"
                               PlaceholderColor="{AppThemeBinding Light=#999999, Dark=#AAAAAA}" />
                    </Frame>
                    
                    <Label Text="{Binding CurrentPasswordError}" 
                           FontSize="12" 
                           TextColor="Red" 
                           IsVisible="{Binding CurrentPasswordError, Converter={StaticResource StringToBoolConverter}}" />
                </VerticalStackLayout>
            </Frame>

            <!-- New Password -->
            <Frame BackgroundColor="{AppThemeBinding Light=#FFFFFF, Dark=#2D2D2D}" 
                   CornerRadius="12" 
                   Padding="20" 
                   HasShadow="True">
                <VerticalStackLayout Spacing="15">
                    <Label Text="New Password *" 
                           FontSize="16" 
                           FontAttributes="Bold" 
                           TextColor="{AppThemeBinding Light=#333333, Dark=#FFFFFF}" />
                    
                    <Frame BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#404040}" 
                           CornerRadius="12" 
                           Padding="16" 
                           HasShadow="False">
                        <Entry Placeholder="Enter new password" 
                               Text="{Binding NewPassword}" 
                               IsPassword="True"
                               BackgroundColor="Transparent" 
                               TextColor="{AppThemeBinding Light=#333333, Dark=#FFFFFF}"
                               PlaceholderColor="{AppThemeBinding Light=#999999, Dark=#AAAAAA}" />
                    </Frame>
                    
                    <Label Text="{Binding NewPasswordError}" 
                           FontSize="12" 
                           TextColor="Red" 
                           IsVisible="{Binding NewPasswordError, Converter={StaticResource StringToBoolConverter}}" />
                </VerticalStackLayout>
            </Frame>

            <!-- Confirm New Password -->
            <Frame BackgroundColor="{AppThemeBinding Light=#FFFFFF, Dark=#2D2D2D}" 
                   CornerRadius="12" 
                   Padding="20" 
                   HasShadow="True">
                <VerticalStackLayout Spacing="15">
                    <Label Text="Confirm New Password *" 
                           FontSize="16" 
                           FontAttributes="Bold" 
                           TextColor="{AppThemeBinding Light=#333333, Dark=#FFFFFF}" />
                    
                    <Frame BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#404040}" 
                           CornerRadius="12" 
                           Padding="16" 
                           HasShadow="False">
                        <Entry Placeholder="Confirm new password" 
                               Text="{Binding ConfirmNewPassword}" 
                               IsPassword="True"
                               BackgroundColor="Transparent" 
                               TextColor="{AppThemeBinding Light=#333333, Dark=#FFFFFF}"
                               PlaceholderColor="{AppThemeBinding Light=#999999, Dark=#AAAAAA}" />
                    </Frame>
                    
                    <Label Text="{Binding ConfirmNewPasswordError}" 
                           FontSize="12" 
                           TextColor="Red" 
                           IsVisible="{Binding ConfirmNewPasswordError, Converter={StaticResource StringToBoolConverter}}" />
                </VerticalStackLayout>
            </Frame>

            <!-- Password Requirements -->
            <Frame BackgroundColor="{AppThemeBinding Light=#E3F2FD, Dark=#0D47A1}" 
                   CornerRadius="12" 
                   Padding="20" 
                   HasShadow="True">
                <VerticalStackLayout Spacing="10">
                    <Label Text="ðŸ“‹ Password Requirements" 
                           FontSize="16" 
                           FontAttributes="Bold" 
                           TextColor="{AppThemeBinding Light=#1976D2, Dark=#90CAF9}" />
                    
                    <VerticalStackLayout Spacing="5">
                        <Label Text="â€¢ At least 8 characters long" 
                               FontSize="14" 
                               TextColor="{Binding IsPasswordLengthValid, Converter={StaticResource BoolToTextColorConverter}}" />
                        <Label Text="â€¢ Contains at least one number" 
                               FontSize="14" 
                               TextColor="{Binding IsPasswordNumberValid, Converter={StaticResource BoolToTextColorConverter}}" />
                        <Label Text="â€¢ Contains at least one uppercase letter" 
                               FontSize="14" 
                               TextColor="{Binding IsPasswordUppercaseValid, Converter={StaticResource BoolToTextColorConverter}}" />
                        <Label Text="â€¢ Contains at least one lowercase letter" 
                               FontSize="14" 
                               TextColor="{Binding IsPasswordLowercaseValid, Converter={StaticResource BoolToTextColorConverter}}" />
                        <Label Text="â€¢ Contains at least one special character" 
                               FontSize="14" 
                               TextColor="{Binding IsPasswordSpecialValid, Converter={StaticResource BoolToTextColorConverter}}" />
                    </VerticalStackLayout>
                </VerticalStackLayout>
            </Frame>

            <!-- Error Message -->
            <Label Text="{Binding ErrorMessage}" 
                   FontSize="14" 
                   TextColor="Red" 
                   HorizontalOptions="Center" 
                   IsVisible="{Binding ErrorMessage, Converter={StaticResource StringToBoolConverter}}" />

            <!-- Action Buttons -->
            <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                <Button Grid.Column="0" 
                        Text="ðŸ”™ Back" 
                        BackgroundColor="{AppThemeBinding Light=#6C757D, Dark=#495057}" 
                        TextColor="White" 
                        CornerRadius="12" 
                        FontSize="16" 
                        FontAttributes="Bold" 
                        Padding="20" 
                        Command="{Binding BackCommand}" />
                <Button Grid.Column="1" 
                        Text="ðŸ’¾ Update Password" 
                        BackgroundColor="{AppThemeBinding Light=#4CAF50, Dark=#388E3C}" 
                        TextColor="White" 
                        CornerRadius="12" 
                        FontSize="16" 
                        FontAttributes="Bold" 
                        Padding="20" 
                        Command="{Binding UpdatePasswordCommand}"
                        IsEnabled="{Binding IsFormValid}" />
            </Grid>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
