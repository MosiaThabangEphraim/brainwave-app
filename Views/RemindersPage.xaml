<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:BrainWave.APP.ViewModels"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             x:Class="BrainWave.APP.Views.RemindersPage"
             Title="Reminders"
             BackgroundColor="{AppThemeBinding Light=#F8F9FA, Dark=#1A1A1A}">

    <ContentPage.BindingContext>
        <vm:RemindersViewModel />
    </ContentPage.BindingContext>

    <Grid RowDefinitions="Auto,*">
        
        <!-- Header -->
        <Frame Grid.Row="0" 
               BackgroundColor="{AppThemeBinding Light=#4A90E2, Dark=#2C5AA0}" 
               CornerRadius="0" 
               Padding="20" 
               Margin="0,0,0,10">
            <Grid ColumnDefinitions="*,Auto,Auto,Auto,Auto" ColumnSpacing="8">
                <VerticalStackLayout Grid.Column="0">
                    <Label Text="⏰ My Reminders" 
                           FontSize="24" 
                           FontAttributes="Bold" 
                           TextColor="White" />
                    <Label Text="Never miss important tasks" 
                           FontSize="14" 
                           TextColor="White" 
                           Opacity="0.9" />
                </VerticalStackLayout>
                <Button Grid.Column="1"
                        Text="➕ Create"
                        BackgroundColor="{AppThemeBinding Light=#FFFFFF, Dark=#FFFFFF}"
                        TextColor="{AppThemeBinding Light=#4A90E2, Dark=#4A90E2}"
                        CornerRadius="8"
                        FontSize="12"
                        FontAttributes="Bold"
                        Padding="12,8"
                        VerticalOptions="Center"
                        Command="{Binding ShowCreateFormCommand}" />
                <Button Grid.Column="2"
                        Text="Refresh"
                        BackgroundColor="{AppThemeBinding Light=#FFFFFF, Dark=#FFFFFF}"
                        TextColor="{AppThemeBinding Light=#4A90E2, Dark=#4A90E2}"
                        CornerRadius="8"
                        FontSize="12"
                        FontAttributes="Bold"
                        Padding="12,8"
                        VerticalOptions="Center"
                        Command="{Binding RefreshCommand}" />
                <Button Grid.Column="3"
                        Text="🚪 Logout"
                        BackgroundColor="{AppThemeBinding Light=#FFFFFF, Dark=#FFFFFF}"
                        TextColor="{AppThemeBinding Light=#4A90E2, Dark=#4A90E2}"
                        CornerRadius="8"
                        FontSize="12"
                        FontAttributes="Bold"
                        Padding="12,8"
                        VerticalOptions="Center"
                        Command="{Binding LogoutCommand}" />
                <Button Grid.Column="4"
                        Text="❓"
                        BackgroundColor="{AppThemeBinding Light=#FFFFFF, Dark=#FFFFFF}"
                        TextColor="{AppThemeBinding Light=#4A90E2, Dark=#4A90E2}"
                        CornerRadius="8"
                        FontSize="16"
                        FontAttributes="Bold"
                        Padding="12,8"
                        VerticalOptions="Center"
                        Clicked="HelpButton_Clicked" />
            </Grid>
        </Frame>

        <!-- Main Content Area -->
        <Grid Grid.Row="1" RowDefinitions="Auto,*">
            
            <!-- Search and Filters -->
            <Frame Grid.Row="0" 
                   BackgroundColor="{AppThemeBinding Light=#FFFFFF, Dark=#2D2D2D}" 
                   CornerRadius="8" 
                   Padding="8" 
                   Margin="12,0,12,6"
                   HasShadow="True">
                <VerticalStackLayout Spacing="6">
                    <!-- Search Bar -->
                    <Frame BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#404040}" 
                           CornerRadius="6" 
                           Padding="8" 
                           HasShadow="False">
                        <Grid ColumnDefinitions="Auto,*">
                            <Label Grid.Column="0" 
                                   Text="🔍" 
                                   FontSize="14" 
                                   VerticalOptions="Center" 
                                   Margin="0,0,6,0" />
                            <Entry Grid.Column="1" 
                                   Text="{Binding SearchText}" 
                                   Placeholder="Search..." 
                                   BackgroundColor="Transparent" 
                                   TextColor="{AppThemeBinding Light=#333333, Dark=#FFFFFF}"
                                   PlaceholderColor="{AppThemeBinding Light=#999999, Dark=#AAAAAA}"
                                   FontSize="14" />
                        </Grid>
                    </Frame>
                    
                    <!-- Sort Controls in One Row -->
                    <Grid ColumnDefinitions="*,*" ColumnSpacing="6">
                        <Picker Grid.Column="0" 
                                Title="Sort By" 
                                BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#404040}" 
                                TextColor="{AppThemeBinding Light=#333333, Dark=#FFFFFF}"
                                SelectedItem="{Binding SortBy}"
                                FontSize="12"
                                HeightRequest="35">
                            <Picker.Items>
                                <x:String>Title</x:String>
                                <x:String>ReminderTime</x:String>
                            </Picker.Items>
                        </Picker>
                        
                        <Picker Grid.Column="1" 
                                Title="Sort Order" 
                                BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#404040}" 
                                TextColor="{AppThemeBinding Light=#333333, Dark=#FFFFFF}"
                                SelectedItem="{Binding SortOrder}"
                                FontSize="12"
                                HeightRequest="35">
                            <Picker.Items>
                                <x:String>Ascending</x:String>
                                <x:String>Descending</x:String>
                            </Picker.Items>
                        </Picker>
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <!-- Reminders List or Create Form -->
            <Grid Grid.Row="1">
                
                <!-- Reminders List View -->
                <ScrollView IsVisible="{Binding ShowRemindersList}">
                    <VerticalStackLayout Padding="12" Spacing="8">
                        
                        <!-- Empty State -->
                        <Frame IsVisible="{Binding Items.Count, Converter={StaticResource StringToBoolConverter}, ConverterParameter=invert}"
                               BackgroundColor="{AppThemeBinding Light=#FFFFFF, Dark=#2D2D2D}" 
                               CornerRadius="16" 
                               Padding="40" 
                               HasShadow="True">
                            <VerticalStackLayout Spacing="16" HorizontalOptions="Center">
                                <Label Text="⏰" FontSize="48" HorizontalOptions="Center" />
                                <Label Text="No Reminders Set" 
                                       FontSize="18" 
                                       FontAttributes="Bold" 
                                       TextColor="{AppThemeBinding Light=#333333, Dark=#FFFFFF}" 
                                       HorizontalOptions="Center" />
                                <Label Text="Create your first reminder to stay on track" 
                                       FontSize="14" 
                                       TextColor="{AppThemeBinding Light=#666666, Dark=#CCCCCC}" 
                                       HorizontalOptions="Center" 
                                       HorizontalTextAlignment="Center" />
                            </VerticalStackLayout>
                        </Frame>

                        <!-- Reminder Items -->
                        <CollectionView ItemsSource="{Binding Items}" 
                                        BackgroundColor="Transparent">
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <SwipeView>
                                        <SwipeView.RightItems>
                                            <SwipeItems>
                                                <SwipeItem Text="Delete" 
                                                           BackgroundColor="Red" 
                                                           Command="{Binding Source={RelativeSource AncestorType={x:Type vm:RemindersViewModel}}, Path=DeleteCommand}"
                                                           CommandParameter="{Binding .}" />
                                            </SwipeItems>
                                        </SwipeView.RightItems>
                                        
                                        <Frame BackgroundColor="{AppThemeBinding Light=#FFFFFF, Dark=#2D2D2D}" 
                                               CornerRadius="10" 
                                               Padding="16" 
                                               HasShadow="True"
                                               Margin="0,4">
                                            <Grid RowDefinitions="Auto,Auto,Auto" ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12" RowSpacing="8">
                                                
                                                <!-- Status Icon -->
                                                <Label Grid.Row="0" Grid.Column="0" Grid.RowSpan="2"
                                                       Text="{Binding IsCompleted, Converter={StaticResource BoolToReminderIconConverter}}"
                                                       FontSize="24" 
                                                       VerticalOptions="Start" 
                                                       Margin="0,0,12,0" />

                                                <!-- Task Title -->
                                                <Label Grid.Row="0" Grid.Column="1"
                                                       Text="{Binding Title}" 
                                                       FontSize="16" 
                                                       FontAttributes="Bold" 
                                                       TextColor="{AppThemeBinding Light=#333333, Dark=#FFFFFF}"
                                                       LineBreakMode="WordWrap" />

                                                <!-- Reminder Type and Time -->
                                                <Label Grid.Row="1" Grid.Column="1"
                                                       Text="{Binding ReminderTime, StringFormat='📧 Email • 📅 {0:MMM dd, yyyy HH:mm}'}" 
                                                       FontSize="14" 
                                                       TextColor="{AppThemeBinding Light=#4A90E2, Dark=#90CAF9}" />

                                                <!-- Actions -->
                                                <HorizontalStackLayout Grid.Row="2" Grid.Column="1"
                                                                      Spacing="6" 
                                                                      Margin="0,8,0,0">
                                                    <Button Text="View" 
                                                            BackgroundColor="{AppThemeBinding Light=#2196F3, Dark=#1976D2}" 
                                                            TextColor="White" 
                                                            CornerRadius="8" 
                                                            FontSize="10" 
                                                            Padding="16,6"
                                                            WidthRequest="80"
                                                            Command="{Binding Source={RelativeSource AncestorType={x:Type vm:RemindersViewModel}}, Path=ViewCommand}"
                                                            CommandParameter="{Binding .}" />
                                                    <Button Text="Delete" 
                                                            BackgroundColor="{AppThemeBinding Light=#F44336, Dark=#D32F2F}" 
                                                            TextColor="White" 
                                                            CornerRadius="8" 
                                                            FontSize="10" 
                                                            Padding="16,6"
                                                            WidthRequest="80"
                                                            Command="{Binding Source={RelativeSource AncestorType={x:Type vm:RemindersViewModel}}, Path=DeleteCommand}"
                                                            CommandParameter="{Binding .}" />
                                                </HorizontalStackLayout>
                                            </Grid>
                                        </Frame>
                                    </SwipeView>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>
                </ScrollView>

                <!-- Create/Edit Reminder Form -->
                <ScrollView IsVisible="{Binding ShowCreateForm}">
                    <VerticalStackLayout Padding="20" Spacing="16">
                        
                        <Label Text="{Binding FormTitle}" 
                               FontSize="24" 
                               FontAttributes="Bold" 
                               TextColor="{AppThemeBinding Light=#333333, Dark=#FFFFFF}" 
                               HorizontalOptions="Center" />
                        
                        <!-- Task Selection Status -->
                        <Frame BackgroundColor="{AppThemeBinding Light=#E3F2FD, Dark=#0D47A1}" 
                               CornerRadius="12" 
                               Padding="16" 
                               HasShadow="False">
                            <VerticalStackLayout Spacing="8">
                                <Label Text="{Binding SelectedTaskDisplayText}" 
                                       FontSize="16" 
                                       FontAttributes="Bold" 
                                       TextColor="{AppThemeBinding Light=#1976D2, Dark=#90CAF9}"
                                       HorizontalOptions="Center" />
                                
                                <Label Text="Choose a task below to set a reminder" 
                                       FontSize="12" 
                                       TextColor="{AppThemeBinding Light=#1976D2, Dark=#90CAF9}"
                                       HorizontalOptions="Center"
                                       IsVisible="{Binding IsTaskSelected, Converter={StaticResource InvertedBoolConverter}}" />
                            </VerticalStackLayout>
                        </Frame>

                        <!-- Task Selection -->
                        <Frame BackgroundColor="{AppThemeBinding Light=#E8F5E8, Dark=#1B5E20}" 
                               CornerRadius="12" 
                               Padding="16" 
                               HasShadow="False">
                            <VerticalStackLayout Spacing="8">
                                <Label Text="📋 Available Tasks" 
                                       FontSize="14" 
                                       FontAttributes="Bold" 
                                       TextColor="{AppThemeBinding Light=#2E7D32, Dark=#A5D6A7}" />
                                
                                <CollectionView ItemsSource="{Binding AvailableTasks}" 
                                                HeightRequest="120"
                                                BackgroundColor="Transparent">
                                    <CollectionView.ItemTemplate>
                                        <DataTemplate>
                                            <Frame BackgroundColor="{AppThemeBinding Light=#F0F8F0, Dark=#2E7D32}" 
                                                   CornerRadius="8" 
                                                   Padding="12" 
                                                   Margin="0,2">
                                                <Grid ColumnDefinitions="*,Auto">
                                                    <VerticalStackLayout Grid.Column="0">
                                                        <Label Text="{Binding Title}" 
                                                               FontSize="14" 
                                                               FontAttributes="Bold" 
                                                               TextColor="{AppThemeBinding Light=#2E7D32, Dark=#A5D6A7}" />
                                                        <Label Text="{Binding DueDate, StringFormat='Due: {0:MMM dd, yyyy}'}" 
                                                               FontSize="12" 
                                                               TextColor="{AppThemeBinding Light=#2E7D32, Dark=#A5D6A7}" />
                                                    </VerticalStackLayout>
                                                    <Button Grid.Column="1" 
                                                            Text="Select Task" 
                                                            BackgroundColor="{AppThemeBinding Light=#4CAF50, Dark=#2E7D32}" 
                                                            TextColor="White" 
                                                            CornerRadius="6" 
                                                            FontSize="12" 
                                                            Padding="12,6"
                                                            Command="{Binding Source={RelativeSource AncestorType={x:Type vm:RemindersViewModel}}, Path=SelectTaskCommand}"
                                                            CommandParameter="{Binding .}" />
                                                </Grid>
                                            </Frame>
                                        </DataTemplate>
                                    </CollectionView.ItemTemplate>
                                </CollectionView>
                            </VerticalStackLayout>
                        </Frame>
                        
                        <!-- Reminder Info -->
                        <Frame BackgroundColor="{AppThemeBinding Light=#E8F5E8, Dark=#1B5E20}" 
                               CornerRadius="12" 
                               Padding="16" 
                               HasShadow="False">
                            <VerticalStackLayout Spacing="8">
                                <Label Text="📋 Reminder Information" 
                                       FontSize="14" 
                                       FontAttributes="Bold" 
                                       TextColor="{AppThemeBinding Light=#2E7D32, Dark=#A5D6A7}" />
                                <Label Text="The reminder will use the task's title. You only need to set the date and time." 
                                       FontSize="12" 
                                       TextColor="{AppThemeBinding Light=#2E7D32, Dark=#A5D6A7}"
                                       HorizontalOptions="Center"
                                       HorizontalTextAlignment="Center" />
                            </VerticalStackLayout>
                        </Frame>

                        <!-- Date and Time Selection -->
                        <Frame BackgroundColor="{AppThemeBinding Light=#FFF3E0, Dark=#E65100}" 
                               CornerRadius="12" 
                               Padding="16" 
                               HasShadow="False">
                            <VerticalStackLayout Spacing="12">
                                <Label Text="⏰ Set Reminder Date &amp; Time" 
                                       FontSize="14" 
                                       FontAttributes="Bold" 
                                       TextColor="{AppThemeBinding Light=#F57C00, Dark=#FFB74D}"
                                       HorizontalOptions="Center" />
                                
                                <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                                    <Frame Grid.Column="0" 
                                           BackgroundColor="{AppThemeBinding Light=#FFFFFF, Dark=#424242}" 
                                           CornerRadius="8" 
                                           Padding="12" 
                                           HasShadow="False">
                                        <VerticalStackLayout Spacing="4">
                                            <Label Text="📅 Date" 
                                                   FontSize="12" 
                                                   FontAttributes="Bold" 
                                                   TextColor="{AppThemeBinding Light=#F57C00, Dark=#FFB74D}"
                                                   HorizontalOptions="Start" />
                                            <DatePicker Date="{Binding Editing.ReminderDate}" 
                                                        BackgroundColor="Transparent" 
                                                        TextColor="{AppThemeBinding Light=#333333, Dark=#FFFFFF}"
                                                        FontSize="14"
                                                        Format="MMM dd, yyyy"
                                                        MinimumDate="{Binding Source={x:Static sys:DateTime.Today}}"
                                                        x:Name="ReminderDatePicker" />
                                        </VerticalStackLayout>
                                    </Frame>
                                    
                                    <Frame Grid.Column="1" 
                                           BackgroundColor="{AppThemeBinding Light=#FFFFFF, Dark=#424242}" 
                                           CornerRadius="8" 
                                           Padding="12" 
                                           HasShadow="False">
                                        <VerticalStackLayout Spacing="4">
                                            <Label Text="🕐 Time" 
                                                   FontSize="12" 
                                                   FontAttributes="Bold" 
                                                   TextColor="{AppThemeBinding Light=#F57C00, Dark=#FFB74D}"
                                                   HorizontalOptions="Start" />
                                            <TimePicker Time="{Binding Editing.ReminderTimeSpan}" 
                                                        BackgroundColor="Transparent" 
                                                        TextColor="{AppThemeBinding Light=#333333, Dark=#FFFFFF}"
                                                        FontSize="14"
                                                        Format="HH:mm"
                                                        x:Name="ReminderTimePicker" />
                                        </VerticalStackLayout>
                                    </Frame>
                                </Grid>
                                
                                <Label Text="{Binding Editing.ReminderTime, StringFormat='Selected: {0:MMMM dd, yyyy at h:mm tt}'}" 
                                       FontSize="12" 
                                       TextColor="{AppThemeBinding Light=#F57C00, Dark=#FFB74D}"
                                       HorizontalOptions="Center"
                                       FontAttributes="Italic" />
                                
                                <!-- Quick Time Selection -->
                                <Frame BackgroundColor="{AppThemeBinding Light=#F0F8F0, Dark=#2E7D32}" 
                                       CornerRadius="8" 
                                       Padding="12" 
                                       HasShadow="False">
                                    <VerticalStackLayout Spacing="8">
                                        <Label Text="⏰ Quick Time Selection" 
                                               FontSize="12" 
                                               FontAttributes="Bold" 
                                               TextColor="{AppThemeBinding Light=#2E7D32, Dark=#A5D6A7}"
                                               HorizontalOptions="Center" />
                                        
                                        <Grid ColumnDefinitions="*,*,*" ColumnSpacing="8">
                                            <Button Grid.Column="0" 
                                                    Text="9:00 AM" 
                                                    BackgroundColor="{AppThemeBinding Light=#4CAF50, Dark=#2E7D32}" 
                                                    TextColor="White" 
                                                    CornerRadius="6" 
                                                    FontSize="12" 
                                                    Padding="8,4"
                                                    Clicked="SetQuickTime_Clicked" />
                                            <Button Grid.Column="1" 
                                                    Text="2:00 PM" 
                                                    BackgroundColor="{AppThemeBinding Light=#4CAF50, Dark=#2E7D32}" 
                                                    TextColor="White" 
                                                    CornerRadius="6" 
                                                    FontSize="12" 
                                                    Padding="8,4"
                                                    Clicked="SetQuickTime_Clicked" />
                                            <Button Grid.Column="2" 
                                                    Text="6:00 PM" 
                                                    BackgroundColor="{AppThemeBinding Light=#4CAF50, Dark=#2E7D32}" 
                                                    TextColor="White" 
                                                    CornerRadius="6" 
                                                    FontSize="12" 
                                                    Padding="8,4"
                                                    Clicked="SetQuickTime_Clicked" />
                                        </Grid>
                                    </VerticalStackLayout>
                                </Frame>
                            </VerticalStackLayout>
                        </Frame>

                        <!-- Action Buttons -->
                        <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                            <Button Grid.Column="0"
                                    Text="Create Reminder" 
                                    Command="{Binding CreateCommand}" 
                                    BackgroundColor="{AppThemeBinding Light=#4A90E2, Dark=#2C5AA0}" 
                                    TextColor="White" 
                                    CornerRadius="12" 
                                    FontSize="16" 
                                    FontAttributes="Bold" 
                                    HeightRequest="50"
                                    IsEnabled="{Binding IsBusy, Converter={StaticResource InvertedBoolConverter}}"
                                    IsVisible="{Binding Editing.ReminderID, Converter={StaticResource IntToBoolConverter}, ConverterParameter=0}" />
                            
                            <Button Grid.Column="1"
                                    Text="Update Reminder" 
                                    Command="{Binding UpdateCommand}" 
                                    BackgroundColor="{AppThemeBinding Light=#FFA500, Dark=#FF8C00}" 
                                    TextColor="White" 
                                    CornerRadius="12" 
                                    FontSize="16" 
                                    FontAttributes="Bold" 
                                    HeightRequest="50"
                                    IsEnabled="{Binding IsBusy, Converter={StaticResource InvertedBoolConverter}}"
                                    IsVisible="{Binding Editing.ReminderID, Converter={StaticResource IntToBoolConverter}}" />
                        </Grid>

                        <Button Text="Back to Reminders" 
                                Command="{Binding BackToRemindersCommand}" 
                                BackgroundColor="{AppThemeBinding Light=#6C757D, Dark=#495057}" 
                                TextColor="White" 
                                CornerRadius="12" 
                                FontSize="16" 
                                FontAttributes="Bold" 
                                HeightRequest="50" />

                        <ActivityIndicator IsVisible="{Binding IsBusy}" 
                                          IsRunning="{Binding IsBusy}" 
                                          Color="{AppThemeBinding Light=#4A90E2, Dark=#2C5AA0}" />
                    </VerticalStackLayout>
                </ScrollView>
            </Grid>
        </Grid>

        <!-- Reminder Details Popup -->
        <Grid x:Name="ReminderPopup" 
              IsVisible="False"
              BackgroundColor="Transparent"
              VerticalOptions="FillAndExpand"
              HorizontalOptions="FillAndExpand">
            
            <!-- Semi-transparent overlay -->
            <BoxView BackgroundColor="Black" 
                     Opacity="0.5" 
                     VerticalOptions="FillAndExpand" 
                     HorizontalOptions="FillAndExpand">
                <BoxView.GestureRecognizers>
                    <TapGestureRecognizer Tapped="ClosePopupOverlay_Clicked" />
                </BoxView.GestureRecognizers>
            </BoxView>
            
            <!-- Popup content -->
            <Frame BackgroundColor="{AppThemeBinding Light=#FFFFFF, Dark=#2D2D2D}" 
                   CornerRadius="16" 
                   Padding="20" 
                   Margin="40"
                   HasShadow="True"
                   VerticalOptions="Center"
                   HorizontalOptions="Center"
                   WidthRequest="350"
                   HeightRequest="500">
            <ScrollView>
                <VerticalStackLayout Spacing="16">
                    
                    <!-- Popup Header -->
                    <Grid ColumnDefinitions="*,Auto">
                        <Label Grid.Column="0" 
                               Text="⏰ Reminder Details" 
                               FontSize="20" 
                               FontAttributes="Bold" 
                               TextColor="{AppThemeBinding Light=#333333, Dark=#FFFFFF}" />
                        <Button Grid.Column="1" 
                                Text="✕" 
                                BackgroundColor="Transparent" 
                                TextColor="{AppThemeBinding Light=#666666, Dark=#CCCCCC}" 
                                FontSize="18" 
                                FontAttributes="Bold"
                                Padding="0"
                                Clicked="ClosePopup_Clicked" />
                    </Grid>
                    
                    
                    <!-- Reminder Date -->
                    <Frame BackgroundColor="{AppThemeBinding Light=#F8F9FA, Dark=#404040}" 
                           CornerRadius="8" 
                           Padding="12" 
                           HasShadow="False">
                        <VerticalStackLayout Spacing="4">
                            <Label Text="Date" 
                                   FontSize="12" 
                                   FontAttributes="Bold" 
                                   TextColor="{AppThemeBinding Light=#666666, Dark=#CCCCCC}" />
                            <DatePicker x:Name="PopupDate" 
                                        BackgroundColor="Transparent" 
                                        TextColor="{AppThemeBinding Light=#333333, Dark=#FFFFFF}"
                                        FontSize="16" />
                        </VerticalStackLayout>
                    </Frame>
                    
                    <!-- Reminder Time -->
                    <Frame BackgroundColor="{AppThemeBinding Light=#F8F9FA, Dark=#404040}" 
                           CornerRadius="8" 
                           Padding="12" 
                           HasShadow="False">
                        <VerticalStackLayout Spacing="4">
                            <Label Text="Time" 
                                   FontSize="12" 
                                   FontAttributes="Bold" 
                                   TextColor="{AppThemeBinding Light=#666666, Dark=#CCCCCC}" />
                            <TimePicker x:Name="PopupTime" 
                                        BackgroundColor="Transparent" 
                                        TextColor="{AppThemeBinding Light=#333333, Dark=#FFFFFF}"
                                        FontSize="16" />
                        </VerticalStackLayout>
                    </Frame>
                    
                    <!-- Action Buttons -->
                    <Grid ColumnDefinitions="*,*,*" ColumnSpacing="8">
                        <Button Grid.Column="0"
                                Text="💾 Update" 
                                BackgroundColor="{AppThemeBinding Light=#4CAF50, Dark=#388E3C}" 
                                TextColor="White" 
                                CornerRadius="8" 
                                FontSize="14" 
                                FontAttributes="Bold" 
                                HeightRequest="40"
                                Clicked="UpdateReminder_Clicked" />
                        
                        <Button Grid.Column="1"
                                Text="🗑️ Delete" 
                                BackgroundColor="{AppThemeBinding Light=#F44336, Dark=#D32F2F}" 
                                TextColor="White" 
                                CornerRadius="8" 
                                FontSize="14" 
                                FontAttributes="Bold" 
                                HeightRequest="40"
                                Clicked="DeleteReminder_Clicked" />
                        
                        <Button Grid.Column="2"
                                Text="❌ Cancel" 
                                BackgroundColor="{AppThemeBinding Light=#9E9E9E, Dark=#616161}" 
                                TextColor="White" 
                                CornerRadius="8" 
                                FontSize="14" 
                                FontAttributes="Bold" 
                                HeightRequest="40"
                                Clicked="ClosePopup_Clicked" />
                    </Grid>
                    
                </VerticalStackLayout>
            </ScrollView>
            </Frame>
        </Grid>

    </Grid>
</ContentPage>